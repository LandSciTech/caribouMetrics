<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using caribouHabitat • caribouMetrics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using caribouHabitat">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">caribouMetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/caribouDemography.html">Caribou Demography</a></li>
    <li><a class="dropdown-item" href="../articles/bayesian-model-outputs.html">Options for using Bayesian model results</a></li>
    <li><a class="dropdown-item" href="../articles/combine-observed-simulated.html">Combine observed and simulated caribou data</a></li>
    <li><a class="dropdown-item" href="../articles/compare-bayesian-models.html">Comparing the caribouMetrics Beta model to bboutools models</a></li>
    <li><a class="dropdown-item" href="../articles/Using_disturbanceMetric.html">Disturbance Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/Using_caribouHabitat.html">Using caribouHabitat</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LandSciTech/caribouMetrics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using caribouHabitat</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LandSciTech/caribouMetrics/blob/master/vignettes/Using_caribouHabitat.Rmd" class="external-link"><code>vignettes/Using_caribouHabitat.Rmd</code></a></small>
      <div class="d-none name"><code>Using_caribouHabitat.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette gives details on the use of the
<code>caribouHabitat</code> function. This function implements the
caribou resource selection probability functions (RSPF) described in <a href="https://doi.org/10.1139/cjz-2015-0101" class="external-link">Hornseth and Rempel,
2016</a> in R. They were previously written in LSL and a goal of this
package is to make them more accessible to a wider range of users.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://landscitech.github.io/caribouMetrics">caribouMetrics</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nimble</span></span>
<span><span class="co">#&gt; nimble version 1.3.0 is loaded.</span></span>
<span><span class="co">#&gt; For more information on NIMBLE and a User Manual,</span></span>
<span><span class="co">#&gt; please visit https://R-nimble.org.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note for advanced users who have written their own MCMC samplers:</span></span>
<span><span class="co">#&gt;   As of version 0.13.0, NIMBLE's protocol for handling posterior</span></span>
<span><span class="co">#&gt;   predictive nodes has changed in a way that could affect user-defined</span></span>
<span><span class="co">#&gt;   samplers in some situations. Please see Section 15.5.1 of the User Manual.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'nimble'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     simulate</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     declare</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.70</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'terra'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:nimble':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     values, values&lt;-</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="va">pthBase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"caribouMetrics"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-needed">Data Needed<a class="anchor" aria-label="anchor" href="#data-needed"></a>
</h2>
<p>Several different data sets are used in the RSPF model to describe
conditions that affect caribou habitat selection. The data includes
types of forest, wetlands, eskers, linear features and disturbance
histories. The table below describes each data set, and what it is used
for.</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="32%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th>Name (Argument)</th>
<th>Description</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Land cover (landCover)</td>
<td>A raster of land cover classified into 7 forest or wetland resource
types</td>
<td>Covariates in RSPF model</td>
</tr>
<tr class="even">
<td>Eskers (esker)</td>
<td>A raster or sf object identifying eskers (deposited ridges of
sediment), if presented as a raster data must be in m/ha</td>
<td>Covariate in RSPF model</td>
</tr>
<tr class="odd">
<td>Linear features (linFeat)</td>
<td>a raster, sf object, or list of these identifying the location of
linear features (e.g. roads, rail), if presented as a raster data must
be in m/ha</td>
<td>Covariate in RSPF model</td>
</tr>
<tr class="even">
<td>Natural disturbance (natDist)</td>
<td>Cumulative natural disturbance (mostly fire) over the past 30
years</td>
<td>Covariate in RSPF model and used to set forest classes in grid cell
to 0 if &gt; 35% disturbed</td>
</tr>
<tr class="odd">
<td>Anthropogenic disturbance (anthroDist)</td>
<td>Presence of anthropogenic disturbance</td>
<td>Used to set forest classes in grid cell to 0 if &gt; 35%
disturbed</td>
</tr>
<tr class="even">
<td>Project polygon (projPoly)</td>
<td>An sf object containing polygon(s) of the study area(s), must
contain a Range column</td>
<td>Used to set the boundaries of the analysis and link range-specific
coefficients to spatial data</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="simple-example">Simple Example<a class="anchor" aria-label="anchor" href="#simple-example"></a>
</h2>
<p>The example data set loaded below includes a small area in the
Nipigon caribou range that we will use as an example. The provincial
land cover (PLC) data are converted to resource types based on look up
tables provided in the package using <code><a href="../reference/reclassPLC.html">reclassPLC()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load example data and classify plc into Resource Types</span></span>
<span><span class="va">landCoverD</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"landCover.tif"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/reclassPLC.html">reclassPLC</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">eskerDras</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"eskerTif.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">eskerDshp</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"esker.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, agr <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span>
<span><span class="va">natDistD</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"natDist.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">anthroDistD</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"anthroDist.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">linFeatDras</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"linFeatTif.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">projectPolyD</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"projectPoly.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                       agr <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span>
<span><span class="va">linFeatDshp</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"roads.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, agr <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span>
<span><span class="va">railD</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"rail.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, agr <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span>
<span><span class="va">utilitiesD</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"utilities.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, agr <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span></code></pre></div>
<p><code>caribouHabitat</code> will prepare the data, process it into
the explanatory variables in the Hornseth and Rempel RSPF models and
then calculate the probability of habitat use in each season at each
location. The function can be run in several different ways, but the
simplest is to provide spatial objects for each data set and a string
identifying one of the Ontario caribou ranges for the
<code>caribouRange</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carHab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span> , </span>
<span>  esker <span class="op">=</span> <span class="va">eskerDras</span>, </span>
<span>  natDist <span class="op">=</span> <span class="va">natDistD</span>, </span>
<span>  anthroDist <span class="op">=</span> <span class="va">anthroDistD</span>, </span>
<span>  linFeat <span class="op">=</span> <span class="va">linFeatDras</span>, </span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD</span>,</span>
<span>  caribouRange <span class="op">=</span> <span class="st">"Nipigon"</span>, </span>
<span>  padProjPoly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; resampling esker to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span></code></pre></div>
<p>The <code>caribouHabitat</code> function returns an S4 object with
the class <code>CaribouHabitat</code>. To access a “SpatRaster” object
with a layer for each covariate in the RSPF model and the predictions
for each season use the <code>results</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">carHab1</span>, max.level <span class="op">=</span> <span class="fl">2</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formal class 'CaribouHabitat' [package "caribouMetrics"] with 9 slots</span></span>
<span><span class="co">#&gt;   ..@ landCover    :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ esker        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ natDist      :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ anthroDist   :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ linFeat      :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ projectPoly  :Classes 'sf' and 'data.frame':   1 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..@ processedData:S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ habitatUse   :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ attributes   :List of 5</span></span>
<span><span class="fu"><a href="../reference/results.html">results</a></span><span class="op">(</span><span class="va">carHab1</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 198, 227, 17  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 400, 400  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 681188, 771988, 12562355, 12641555  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : MNR_Lambert_Conformal_Conic </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :         Fall,       Spring,       Summer,     Winter,       CON,       DEC, ... </span></span>
<span><span class="co">#&gt; min values  : 7.676602e-05, 6.174556e-05, 0.0009961778, 0.01006868, 0.0000000, 0.0000000, ... </span></span>
<span><span class="co">#&gt; max values  : 7.862738e-01, 7.117893e-01, 0.5347827942, 0.36312003, 0.6648335, 0.2365985, ...</span></span></code></pre></div>
<p>You can create a plot of the results directly from the
<code>CaribouHabitat</code> object. If <code>tmap</code> is installed it
will be used to make a plot, if not <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot</a></code> will be
used. You can provide the season(s) you wish to display and additional
arguments that will be passed on to either <code>qtm</code> or
<code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">carHab1</span>, season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fall"</span>, <span class="st">"Summer"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; tmap must be attached with library(tmap) to be used. Using terra instead.</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/plot1-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="multi-range">Multi-Range<a class="anchor" aria-label="anchor" href="#multi-range"></a>
</h2>
<p><code>caribouHabitat</code> can also be run over multiple ranges
simultaneously. For multiple ranges to be run the
<code>caribouRanges</code> argument must be a data frame with two
columns, <code>Range</code> indicating the name of the caribou range
(must match <code>projectPoly</code>) and <code>coefRange</code>
indicating the name of the range whose coefficients should be used <a href="https://doi.org/10.1139/cjz-2015-0101" class="external-link">Hornseth and Rempel
(2016)</a>. Typically, these should be the same. It is possible to run
the function with coefficients swapped between ranges but this is not
recommended as the models were trained separately on each range. For our
example we have split the area of our data set into four polygons and
arbitrarily assigned them caribou range names to demonstrate the
difference in predictions depending on the coefficients associated with
that range.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">caribouRanges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pagwachuan"</span>, <span class="st">"Missisa"</span>, <span class="st">"Nipigon"</span>, <span class="st">"James Bay"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split the area into 4 polygons</span></span>
<span><span class="va">corners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">projectPolyD</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                 <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">projectPolyD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">projectPolyD4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>Range <span class="op">=</span> <span class="va">caribouRanges</span>,</span>
<span>                     geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">corners</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                       <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">corners</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                       <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">corners</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                       <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">corners</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">projectPolyD</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">projectPolyD4</span>, key.pos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/multi%20example-1.png" width="768"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">caribouRange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Range <span class="op">=</span> <span class="va">caribouRanges</span>, </span>
<span>                           coefRange <span class="op">=</span> <span class="va">caribouRanges</span>, </span>
<span>                           stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MultRange</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span>landCover <span class="op">=</span> <span class="va">landCoverD</span>,</span>
<span>                            esker <span class="op">=</span> <span class="va">eskerDras</span>, </span>
<span>                            linFeat <span class="op">=</span> <span class="va">linFeatDras</span>,  </span>
<span>                            natDist <span class="op">=</span> <span class="va">natDistD</span>,</span>
<span>                            anthroDist <span class="op">=</span> <span class="va">anthroDistD</span>,</span>
<span>                            projectPoly <span class="op">=</span> <span class="va">projectPolyD4</span>, </span>
<span>                            caribouRange <span class="op">=</span> <span class="va">caribouRange</span>, </span>
<span>                            padProjPoly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; resampling esker to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; resampling esker to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span></code></pre></div>
<p>The same S4 object as that created by a single range run is produced,
allowing the same type of interrogation of the results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">MultRange</span>, max.level <span class="op">=</span> <span class="fl">2</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formal class 'CaribouHabitat' [package "caribouMetrics"] with 9 slots</span></span>
<span><span class="co">#&gt;   ..@ landCover    :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ esker        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ natDist      :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ anthroDist   :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ linFeat      :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ projectPoly  :Classes 'sf' and 'data.frame':   4 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..@ processedData:S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ habitatUse   :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ attributes   :List of 5</span></span>
<span><span class="fu"><a href="../reference/results.html">results</a></span><span class="op">(</span><span class="va">MultRange</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 198, 227, 17  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 400, 400  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 681188, 771988, 12562355, 12641555  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : MNR_Lambert_Conformal_Conic </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :         Fall,        Spring,   Summer,        Winter,       CON,       DEC, ... </span></span>
<span><span class="co">#&gt; min values  : 3.525592e-72, 1.316286e-289, 0.000000, 6.201063e-202, 0.0000000, 0.0000000, ... </span></span>
<span><span class="co">#&gt; max values  : 7.933179e-01,  7.739030e-01, 0.973895,  9.940220e-01, 0.6456833, 0.1807492, ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">MultRange</span>, season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Winter"</span>, <span class="st">"Spring"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; tmap must be attached with library(tmap) to be used. Using terra instead.</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/results2-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="example-with-padding">Example with padding<a class="anchor" aria-label="anchor" href="#example-with-padding"></a>
</h2>
<p>In most cases you will have a project area that is smaller than the
environmental data sets available. For our example we will create this
project area by selecting a rectangle inside our example data set.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">landCoverD</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10000</span></span>
<span><span class="va">projectPolyD2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">ext</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">landCoverD</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The information that is outside our project area is still useful for
preventing edge effects in our results. To use this data you can set
<code>padProjPoly = TRUE</code> in the <code>caribouHabitat</code> call
which will set a buffer around the project area based on the size of the
moving window used to scale variables for that range.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carHab2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span>, </span>
<span>  esker <span class="op">=</span> <span class="va">eskerDshp</span>, </span>
<span>  linFeat <span class="op">=</span> <span class="va">linFeatDshp</span>, </span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD2</span>,</span>
<span>  caribouRange <span class="op">=</span> <span class="st">"Nipigon"</span>, </span>
<span>  padProjPoly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">landCoverD</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">carHab2</span><span class="op">@</span><span class="va">landCover</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>col.scale <span class="op">=</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_categorical.html" class="external-link">tm_scale_categorical</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu">cols4all</span><span class="fu">::</span><span class="fu"><a href="https://cols4all.github.io/reference/c4a.html" class="external-link">c4a</a></span><span class="op">(</span><span class="st">"Accent"</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">resTypeCode</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ResourceType</span> <span class="op">!=</span> <span class="st">"DTN"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ResourceType</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    col.legend <span class="op">=</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_legend.html" class="external-link">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"PLC"</span>, bg.color <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>                                 legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">carHab2</span><span class="op">@</span><span class="va">projectPoly</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/inspect%20padded-1.png" width="768"></p>
<p>The black area on the map above shows the extent of the original
<code>landCover</code> data, the raster shows the <code>landCover</code>
data that has been cropped to a buffer around <code>projectPoly</code>
which is the black rectangle.<br>
Next we will demonstrate the importance of setting
<code>padProjPoly = TRUE</code>, if the data is available, by showing
the difference in the results for padding using the data outside the
project area, no padding, and using the value from the edge to pad the
area outside the project using <code>padFocal = TRUE</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">carHab3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span>, </span>
<span>  esker <span class="op">=</span> <span class="va">eskerDshp</span>, </span>
<span>  linFeat <span class="op">=</span> <span class="va">linFeatDshp</span>, </span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD2</span>,</span>
<span>  caribouRange <span class="op">=</span> <span class="st">"Nipigon"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span></span>
<span><span class="va">carHab4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span>, esker <span class="op">=</span> <span class="va">eskerDshp</span>, </span>
<span>  linFeat <span class="op">=</span> <span class="va">linFeatDshp</span>,</span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD2</span>,</span>
<span>  caribouRange <span class="op">=</span> <span class="st">"Nipigon"</span>, </span>
<span>  padProjPoly <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  padFocal <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">projectPolyD2</span><span class="op">)</span></span>
<span><span class="co">#&gt; 4191937500 [m^2]</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">carHab2</span>, season <span class="op">=</span> <span class="st">"Fall"</span>, title <span class="op">=</span> <span class="st">"Pad with data outside project"</span>, </span>
<span>     raster.breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>     layout.legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html" class="external-link">qtm</a></span><span class="op">(</span><span class="va">carHab3</span><span class="op">@</span><span class="va">projectPoly</span>, fill <span class="op">=</span> <span class="cn">NULL</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>            shape.is.master <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_tm_raster()`: migrate the argument(s) related to the scale of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'breaks' to col.scale = tm_scale(&lt;HERE&gt;).</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/compare%20pad-1.png" width="768"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">carHab3</span>, season <span class="op">=</span> <span class="st">"Fall"</span>, title <span class="op">=</span> <span class="st">"No padding"</span>, </span>
<span>     raster.breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>     layout.legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html" class="external-link">qtm</a></span><span class="op">(</span><span class="va">carHab3</span><span class="op">@</span><span class="va">projectPoly</span>, fill <span class="op">=</span> <span class="cn">NULL</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>            shape.is.master <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_tm_raster()`: migrate the argument(s) related to the scale of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'breaks' to col.scale = tm_scale(&lt;HERE&gt;).<span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/compare%20pad-2.png" width="768"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">carHab4</span>, season <span class="op">=</span> <span class="st">"Fall"</span>, title <span class="op">=</span> <span class="st">"Pad with same value as edge"</span>, </span>
<span>     raster.breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>     layout.legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html" class="external-link">qtm</a></span><span class="op">(</span><span class="va">carHab3</span><span class="op">@</span><span class="va">projectPoly</span>, fill <span class="op">=</span> <span class="cn">NULL</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>            shape.is.master <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_tm_raster()`: migrate the argument(s) related to the scale of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'breaks' to col.scale = tm_scale(&lt;HERE&gt;).<span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/compare%20pad-3.png" width="768"></p>
<p>The difference is large in this example because the project area is
very small compared to the window size. The example with no padding is
the default because it prevents users from relying on questionable
results. The example padded with data outside the project polygon is the
preferred option since it makes use of all available information but it
is not the default because it should only be used when the data provided
is larger than the project area. The version where cells are padded the
values from the edge gives results but they can be misleading. Based on
the land cover data in the previous map you can see that there is an
area with resource type LGOP just inside the border of
<code>projectPoly</code> in the top middle. LGOP has a strong positive
effect on caribou habitat so when values from the edge are used to pad
the data the patch of higher use habitat becomes larger than it really
is in the version that uses real data. Therefore it is highly
recommended to provide data for the area around the project and to use
<code>padProjPoly = TRUE</code>.</p>
</div>
<div class="section level2">
<h2 id="example-with-other-inputs">Example with other inputs<a class="anchor" aria-label="anchor" href="#example-with-other-inputs"></a>
</h2>
<p>As mentioned above <code>caribouHabitat</code> can be called in
several different ways. You can provide the data as filepaths instead of
spatial objects, you can provide the eskers and linear features as
vector files which will be converted to rasters, and you can provide a
list of sf objects to be combined into the linear features raster.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carHab4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span>, </span>
<span>  esker <span class="op">=</span> <span class="va">eskerDshp</span>, </span>
<span>  natDist <span class="op">=</span> <span class="va">natDistD</span>,</span>
<span>  anthroDist <span class="op">=</span> <span class="va">anthroDistD</span>,</span>
<span>  linFeat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>roads <span class="op">=</span> <span class="va">linFeatDshp</span>, rail <span class="op">=</span> <span class="va">railD</span>, utilities <span class="op">=</span> <span class="va">utilitiesD</span><span class="op">)</span>,</span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD</span>,</span>
<span>  caribouRange <span class="op">=</span> <span class="st">"Nipigon"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-of-updating-an-existing-object">Example of updating an existing object<a class="anchor" aria-label="anchor" href="#example-of-updating-an-existing-object"></a>
</h2>
<p>In some cases you may want to update an existing object with new data
for one or more of the input data sets. This can be done using
<code>updateCaribou</code>.</p>
<p>For example we can create several data sets that show roads expanding
across our study area and what effect this will have on caribou habitat.
Since the only data set that is changing is the linear features it will
be faster to use <code>updateCaribou</code> rather than
<code>caribouHabitat</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create series of data sets</span></span>
<span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">linFeatDras</span><span class="op">)</span></span>
<span></span>
<span><span class="va">height</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">linFeatDras</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">4</span></span>
<span></span>
<span><span class="va">linFeatDras1</span> <span class="op">&lt;-</span> <span class="va">linFeatDras</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">height</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/extend.html" class="external-link">extend</a></span><span class="op">(</span><span class="va">linFeatDras</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">linFeatDras2</span> <span class="op">&lt;-</span> <span class="va">linFeatDras</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">height</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/extend.html" class="external-link">extend</a></span><span class="op">(</span><span class="va">linFeatDras</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">linFeatDras3</span> <span class="op">&lt;-</span> <span class="va">linFeatDras</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">height</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/extend.html" class="external-link">extend</a></span><span class="op">(</span><span class="va">linFeatDras</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">linFeatDras1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">linFeatDras2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">linFeatDras3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">linFeatDras</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/updateCaribou-1.png" width="576"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span>
<span><span class="co"># Run caribouHabitat to process all the data once</span></span>
<span><span class="co"># Use Missisa range because roads have a larger effect in that model</span></span>
<span><span class="va">carHabLF1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span>,</span>
<span>  esker <span class="op">=</span> <span class="va">eskerDras</span>,</span>
<span>  natDist <span class="op">=</span> <span class="va">natDistD</span>, </span>
<span>  anthroDist <span class="op">=</span> <span class="va">anthroDistD</span>, </span>
<span>  linFeat <span class="op">=</span> <span class="va">linFeatDras1</span>, </span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD</span>, </span>
<span>  caribouRange <span class="op">=</span> <span class="st">"Missisa"</span>, </span>
<span>  padFocal <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; resampling esker to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span></span>
<span><span class="co"># Run updateCaribou with the new linFeat raster</span></span>
<span><span class="va">carHabLF2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateCaribou.html">updateCaribou</a></span><span class="op">(</span><span class="va">carHabLF1</span>, newData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linFeat <span class="op">=</span> <span class="va">linFeatDras2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span></span>
<span><span class="co"># compare results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">carHabLF1</span>, season <span class="op">=</span> <span class="st">"Spring"</span>, tmap <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">"linFeat1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/updateCaribou-2.png" width="576"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">carHabLF2</span>, season <span class="op">=</span> <span class="st">"Spring"</span>, tmap <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">"linFeat2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/updateCaribou-3.png" width="576"></p>
<p>You can see that there is a lower probability of caribou habitat use
when there are more roads (linFeat 2).</p>
</div>
<div class="section level2">
<h2 id="example-using-iteration">Example using Iteration<a class="anchor" aria-label="anchor" href="#example-using-iteration"></a>
</h2>
<p>To go through a large number of updated data sets we can use the
<code>purrr</code> package to iterate over different sets of data</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">linFeatScns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/lst.html" class="external-link">lst</a></span><span class="op">(</span><span class="va">linFeatDras2</span>, <span class="va">linFeatDras3</span>, <span class="va">linFeatDras</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># using carHabLF1 created above we run the update for all three datasets</span></span>
<span></span>
<span><span class="va">linFeatResults</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="va">linFeatScns</span>,</span>
<span>  <span class="op">~</span><span class="fu"><a href="../reference/updateCaribou.html">updateCaribou</a></span><span class="op">(</span><span class="va">carHabLF1</span>, newData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linFeat <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">walk2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">carHabLF1</span>, <span class="va">linFeatResults</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"linFeatDras1"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">linFeatResults</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             <span class="op">~</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">.x</span>, season <span class="op">=</span> <span class="st">"Spring"</span>, tmap <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/unnamed-chunk-2-1.png" width="768"><img src="Using_caribouHabitat_files/figure-html/unnamed-chunk-2-2.png" width="768"><img src="Using_caribouHabitat_files/figure-html/unnamed-chunk-2-3.png" width="768"><img src="Using_caribouHabitat_files/figure-html/unnamed-chunk-2-4.png" width="768"></p>
<p>It is also possible to change just the <code>caribouRange</code>
attribute without recomputing the entire function using the
<code>updateCaribou</code> function. In the example below the coefRange
is changed from Nipigon to Missisa and the predictions are re-calculated
using the coefficients from the Missisa model</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carHab1</span><span class="op">@</span><span class="va">attributes</span><span class="op">$</span><span class="va">caribouRange</span><span class="op">$</span><span class="va">coefRange</span> <span class="op">&lt;-</span> <span class="st">"Missisa"</span></span>
<span></span>
<span><span class="va">misCoef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateCaribou.html">updateCaribou</a></span><span class="op">(</span><span class="va">carHab1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">misCoef</span>, tmap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/update-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="example-with-different-coefficients">Example with different coefficients<a class="anchor" aria-label="anchor" href="#example-with-different-coefficients"></a>
</h2>
<p>Different coefficients can be supplied using the
<code>coefTable</code> argument and if those coefficients are
standardized the data can be standardized by supplying the argument
<code>doScale = TRUE</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carHabStd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span></span>
<span>  landCover <span class="op">=</span> <span class="va">landCoverD</span>,</span>
<span>  esker <span class="op">=</span> <span class="va">eskerDras</span>,</span>
<span>  natDist <span class="op">=</span> <span class="va">natDistD</span>, </span>
<span>  anthroDist <span class="op">=</span> <span class="va">anthroDistD</span>, </span>
<span>  linFeat <span class="op">=</span> <span class="va">linFeatDras</span>, </span>
<span>  projectPoly <span class="op">=</span> <span class="va">projectPolyD</span>, </span>
<span>  caribouRange <span class="op">=</span> <span class="st">"James Bay"</span>, </span>
<span>  coefTable <span class="op">=</span> <span class="va">coefTableStd</span>,</span>
<span>  doScale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeat to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span><span class="co">#&gt; resampling linFeat to match landCover resolution</span></span>
<span><span class="co">#&gt; resampling esker to match landCover resolution</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-with-different-land-cover-data">Example with different land cover data<a class="anchor" aria-label="anchor" href="#example-with-different-land-cover-data"></a>
</h2>
<p><code>reclassPLC</code> assumes that the land cover data come from
the Provincial Land Cover (PLC) data for Ontario and uses the included
table <code>plcToResType</code> to reclassify the raster values from the
PLC codes to “resource types” which are groups of land cover classes
used in the models. You can also supply land cover data from different
sources, for example, the Ontario Far North Land Cover (FNLC) data, in
which case you must supply the appropriate lookup table to convert the
land cover classes to resource types. The <code>fnlcToResType</code>
table is also included with the package but if a different data set was
used you could also supply a custom lookup table. The custom lookup
table must have two columns with names “PLCCode” and “ResourceType”
where “PLCCode” is the value in the land cover raster and “ResourceType”
is the corresponding letter code for the resource type. The possible
resource types are included in <code>resTypeCode</code> and descriptions
of these codes can be found in table S1.3 of <a href="https://osf.io/x6e2q/?view_only=fb71321265d14dbeb3d932e4de66be0c" class="external-link">supplementary
material</a> for Dyson et. al (2022). The resulting map below is quite
different from the map above for the PLC because I used the same raw
data for both but interpreted the codes differently.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landCoverRaw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pthBase</span>, <span class="st">"landCover.tif"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># modify values to match Far North land cover (Not needed if the raw data is</span></span>
<span><span class="co"># actually from the Far North land cover data set)</span></span>
<span><span class="va">landCoverRaw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subst.html" class="external-link">subst</a></span><span class="op">(</span><span class="va">landCoverRaw</span>, from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">29</span><span class="op">)</span>, to  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">99</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use the Far North Land cover lookup table to reclassify the land cover to</span></span>
<span><span class="co"># resource types</span></span>
<span><span class="va">landCoverFN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclassPLC.html">reclassPLC</a></span><span class="op">(</span><span class="va">landCoverRaw</span>, plcLU <span class="op">=</span> <span class="va">fnlcToResType</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">landCoverFN</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>style <span class="op">=</span> <span class="st">"cat"</span>, </span>
<span>                  palette <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="st">"Accent"</span>, n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, </span>
<span>                  labels <span class="op">=</span> <span class="va">resTypeCode</span><span class="op">$</span><span class="va">ResourceType</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"FNLC"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_legend.html" class="external-link">tm_legend</a></span><span class="op">(</span>bg.color <span class="op">=</span> <span class="st">"white"</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html" class="external-link">qtm</a></span><span class="op">(</span><span class="va">carHab2</span><span class="op">@</span><span class="va">projectPoly</span>, fill <span class="op">=</span> <span class="cn">NULL</span>, borders <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cat"`, use col.scale =</span></span>
<span><span class="co">#&gt; `tm_scale_categorical()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'palette' (rename to 'values'), 'labels' to</span></span>
<span><span class="co">#&gt;   'tm_scale_categorical(&lt;HERE&gt;)'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">#&gt; visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `qtm()`: use `col` instead of `borders`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_legend()`: use 'tm_legend()' inside a layer function, e.g.</span></span>
<span><span class="co">#&gt; 'tm_polygons(..., fill.legend = tm_legend())'</span></span>
<span><span class="co">#&gt; Warning: labels do not have the same length as levels, so they are repeated</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/fnlc-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="binary-usage">Binary usage<a class="anchor" aria-label="anchor" href="#binary-usage"></a>
</h2>
<p>You can also determine a binary high or low caribou use result either
by season or for the range as a whole using <code>calcBinaryUse</code>.
The high/low use thresholds were provided by Rempel et al (2021).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binCarHab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcBinaryUse.html">calcBinaryUse</a></span><span class="op">(</span><span class="va">carHab1</span><span class="op">)</span></span>
<span><span class="va">binCarHab1Seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcBinaryUse.html">calcBinaryUse</a></span><span class="op">(</span><span class="va">carHab1</span>, bySeason <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html" class="external-link">qtm</a></span><span class="op">(</span><span class="va">binCarHab1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using_caribouHabitat_files/figure-html/binUse-1.png" width="768"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap::qtm(binCarHab1Seasons)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pre-prepare-data">Pre-prepare data<a class="anchor" aria-label="anchor" href="#pre-prepare-data"></a>
</h2>
<p>To save time re-processing the same inputs you can use
<code>loadSpatialInputs</code> to process a list of raster and vector
spatial objects to match a reference raster and be cropped to a project
polygon. The resulting list can then be used as input for both
<code>caribouHabitat</code> and <code>disturbanceMetrics</code>. We
include the linear features twice so that they can be converted to
raster line density for <code>caribouHabitat</code> but kept as lines
for <code>disturbanceMetrics</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadSpatialInputs.html">loadSpatialInputs</a></span><span class="op">(</span>projectPoly <span class="op">=</span> <span class="va">projectPolyD2</span>, refRast <span class="op">=</span> <span class="va">landCoverD</span>,</span>
<span>                        inputsList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>esker <span class="op">=</span> <span class="va">eskerDshp</span>, </span>
<span>                                          linFeatRas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">linFeatDshp</span>, <span class="va">railD</span>, </span>
<span>                                                            <span class="va">utilitiesD</span><span class="op">)</span>,</span>
<span>                                          linFeatLine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">linFeatDshp</span>, <span class="va">railD</span>, </span>
<span>                                                             <span class="va">utilitiesD</span><span class="op">)</span>,</span>
<span>                                          natDist <span class="op">=</span> <span class="va">natDistD</span>,</span>
<span>                                          anthroDist <span class="op">=</span> <span class="va">anthroDistD</span><span class="op">)</span>,</span>
<span>                        convertToRastDens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"esker"</span>, <span class="st">"linFeatRas"</span><span class="op">)</span>,</span>
<span>                        useTemplate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"esker"</span>, <span class="st">"linFeatRas"</span><span class="op">)</span>,</span>
<span>                        altTemplate <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">landCoverD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                          <span class="fu">`res&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        bufferWidth <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co">#&gt; cropping landCover to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping natDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping anthroDist to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeatRas to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping linFeatLine to extent of projectPoly</span></span>
<span><span class="co">#&gt; cropping esker to extent of projectPoly</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 8</span></span>
<span><span class="co">#&gt;  $ natDist        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ anthroDist     :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ refRast        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ linFeatRas     :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ linFeatLine    :Classes 'sf' and 'data.frame':    5871 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr "linFID"</span></span>
<span><span class="co">#&gt;  $ esker          :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ projectPoly    :Classes 'sf' and 'data.frame':    1 obs. of  1 variable:</span></span>
<span><span class="co">#&gt;   ..- attr(*, "sf_column")= chr "x"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: </span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr(0) </span></span>
<span><span class="co">#&gt;  $ projectPolyOrig:Classes 'sf' and 'data.frame':    1 obs. of  1 variable:</span></span>
<span><span class="co">#&gt;   ..- attr(*, "sf_column")= chr "x"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: </span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr(0)</span></span>
<span></span>
<span><span class="va">resCH</span> <span class="op">&lt;-</span> <span class="va">res</span></span>
<span><span class="va">resCH</span><span class="op">$</span><span class="va">linFeatLine</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resCH</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"linFeatRas"</span>, <span class="st">"linFeat"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resCH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">carHab5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/caribouHabitat.html">caribouHabitat</a></span><span class="op">(</span>preppedData <span class="op">=</span> <span class="va">resCH</span>, caribouRange <span class="op">=</span> <span class="st">"Nipigon"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Applying moving window.</span></span>
<span></span>
<span><span class="va">resDM</span> <span class="op">&lt;-</span> <span class="va">res</span></span>
<span><span class="va">resDM</span><span class="op">$</span><span class="va">linFeatRas</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resDM</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"linFeatLine"</span>, <span class="st">"linFeat"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resDM</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">distMets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/disturbanceMetrics.html">disturbanceMetrics</a></span><span class="op">(</span>preppedData <span class="op">=</span> <span class="va">resDM</span><span class="op">)</span></span>
<span><span class="co">#&gt; buffering anthropogenic disturbance</span></span>
<span><span class="co">#&gt; calculating disturbance metrics</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Rempel, R.S., Carlson, M., Rodgers, A.R., Shuter, J.L., Farrell,
C.E., Cairns, D., Stelfox, B., Hunt, L.M., Mackereth, R.W. and Jackson,
J.M., 2021. Modeling Cumulative Effects of Climate and Development on
Moose, Wolf, and Caribou Populations. The Journal of Wildlife
Management.</p>
<p>Hornseth, M.L. and Rempel, R.S., 2016. Seasonal resource selection of
woodland caribou (Rangifer tarandus caribou) across a gradient of
anthropogenic disturbance. Canadian Journal of Zoology, 94(2), pp.79-93.
<a href="https://doi.org/10.1139/cjz-2015-0101" class="external-link uri">https://doi.org/10.1139/cjz-2015-0101</a></p>
<p>Dyson, M., Endicott, S., Simpkins, C., Turner, J. W., Avery-Gomm, S.,
Johnson, C. A., Leblond, M., Neilson, E. W., Rempel, R., Wiebe, P. A.,
Baltzer, J. L., Stewart, F. E. C., &amp; Hughes, J. (in press). Existing
caribou habitat and demographic models need improvement for Ring of Fire
impact assessment: A roadmap for improving the usefulness, transparency,
and availability of models for conservation. <a href="https://doi.org/10.1101/2022.06.01.494350" class="external-link uri">https://doi.org/10.1101/2022.06.01.494350</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josie Hughes, Sarah Endicott, Yuko Shimoda, Craig Simpkins, Tati Michelleti, Eliot McIntire.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
